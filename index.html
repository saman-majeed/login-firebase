<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login / Signup</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="styles.css"/>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body>
  <div class="container" id="container">
    <div class="mobile-toggle">
      <button id="mobileToggle" onclick="toggleMobileForm()">Switch to Sign Up</button>
    </div>

    <!-- Sign In -->
    <div class="form-container sign-in-container">
      <h1>Sign In</h1>
      <span>or use your email password</span>
      <div class="input-container">
        <input type="email" id="signin-email" placeholder="Email" />
        <span class="error-message" id="signin-email-error"></span>
      </div>
      <div class="input-container">
        <div class="password-input-wrapper">
          <input type="password" id="signin-password" placeholder="Password" />
          <button type="button" class="password-toggle" id="signin-password-toggle">
            <svg class="eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
            <svg class="eye-off-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
              <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
              <line x1="1" y1="1" x2="23" y2="23"></line>
            </svg>
          </button>
        </div>
        <span class="error-message" id="signin-password-error"></span>
      </div>
      <a href="#" class="forgot-password">Forgot Your Password?</a>
      <button class="main-button" id="signin-btn">SIGN IN</button>
      <button type="button" class="main-button" id="resend-verification-btn" style="display: none; background-color: #ff9800; margin-top: 10px;">Resend Verification Email</button>
    </div>

    <!-- Sign Up -->
    <div class="form-container sign-up-container">
      <h1>Create Account</h1>
      <span>or use your email for registration</span>
      <div class="input-container">
        <input type="text" id="signup-name" placeholder="Name" />
        <span class="error-message" id="signup-name-error"></span>
      </div>
      <div class="input-container">
        <input type="email" id="signup-email" placeholder="Email" />
        <span class="error-message" id="signup-email-error"></span>
      </div>
      <div class="input-container">
        <div class="password-input-wrapper">
          <input type="password" id="signup-password" placeholder="Password" />
          <button type="button" class="password-toggle" id="signup-password-toggle">
            <svg class="eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
            <svg class="eye-off-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
              <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
              <line x1="1" y1="1" x2="23" y2="23"></line>
            </svg>
          </button>
        </div>
        <span class="error-message" id="signup-password-error"></span>
        <div class="password-strength" id="password-strength">
          <div class="strength-bar">
            <div class="strength-fill" id="strength-fill"></div>
          </div>
          <span class="strength-text" id="strength-text">Password Strength</span>
        </div>
      </div>
      <button class="main-button" id="signup-btn">SIGN UP</button>
    </div>

    <!-- Overlay -->
    <div class="overlay-container">
      <div class="overlay">
        <div class="overlay-panel overlay-left">
          <h1>Welcome Back!</h1>
          <p>Enter your personal details to use all of site features</p>
          <button onclick="toggleForm()">SIGN IN</button>
        </div>
        <div class="overlay-panel overlay-right">
          <h1>Hello, Friend!</h1>
          <p>Register with your personal details to use all of our features</p>
          <button onclick="toggleForm()">SIGN UP</button>
        </div>
      </div>
    </div>
  </div>


  <script>
    const container = document.getElementById('container');
    const mobileToggle = document.getElementById('mobileToggle');
    const signInContainer = document.querySelector('.sign-in-container');
    const signUpContainer = document.querySelector('.sign-up-container');

    function toggleForm() {
      container.classList.toggle('active');
    }

    function toggleMobileForm() {
      if (window.innerWidth <= 768) {
        if (signInContainer.style.display === 'none') {
          signInContainer.style.display = 'block';
          signUpContainer.style.display = 'none';
          mobileToggle.textContent = 'Switch to Sign Up';
        } else {
          signInContainer.style.display = 'none';
          signUpContainer.style.display = 'block';
          mobileToggle.textContent = 'Switch to Sign In';
        }
      } else {
        toggleForm();
      }
    }

    window.addEventListener('resize', function () {
      if (window.innerWidth > 768) {
        signInContainer.style.display = '';
        signUpContainer.style.display = '';
        mobileToggle.textContent = 'Switch to Sign Up';
      }
    });

    // Validation Functions
    function validateEmail(email) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(email);
    }

    function validateName(name) {
      return name.trim().length >= 3;
    }

    function validatePassword(password) {
      const requirements = {
        length: password.length >= 8,
        uppercase: /[A-Z]/.test(password),
        lowercase: /[a-z]/.test(password),
        number: /\d/.test(password),
        special: /[!@#$%^&*(),.?":{}|<>]/.test(password)
      };
      return requirements;
    }

    function showError(elementId, message) {
      const errorElement = document.getElementById(elementId);
      errorElement.textContent = message;
      errorElement.style.display = 'block';
    }

    function hideError(elementId) {
      const errorElement = document.getElementById(elementId);
      errorElement.textContent = '';
      errorElement.style.display = 'none';
    }

    function updatePasswordStrength(requirements) {
      const strengthFill = document.getElementById('strength-fill');
      const strengthText = document.getElementById('strength-text');
      
      // Count how many requirements are met
      const metRequirements = Object.values(requirements).filter(req => req).length;
      const totalRequirements = Object.keys(requirements).length;
      
      // Calculate strength percentage
      const strengthPercentage = (metRequirements / totalRequirements) * 100;
      
      // Update the strength bar width
      strengthFill.style.width = strengthPercentage + '%';
      
      // Update color and text based on strength
      let strengthLevel = '';
      let color = '';
      
      if (metRequirements === 0) {
        strengthLevel = 'Password Strength';
        color = '#e0e0e0';
      } else if (metRequirements <= 2) {
        strengthLevel = 'Weak';
        color = '#ff4444';
      } else if (metRequirements <= 3) {
        strengthLevel = 'Fair';
        color = '#ffaa00';
      } else if (metRequirements <= 4) {
        strengthLevel = 'Good';
        color = '#88cc00';
      } else {
        strengthLevel = 'Strong';
        color = '#00aa00';
      }
      
      strengthFill.style.backgroundColor = color;
      strengthText.textContent = strengthLevel;
      strengthText.style.color = color;
    }

    // Real-time validation for signup form
    document.getElementById('signup-name').addEventListener('input', function() {
      const name = this.value;
      if (name.length === 0) {
        hideError('signup-name-error');
      } else if (!validateName(name)) {
        showError('signup-name-error', 'Name must be at least 3 characters long');
      } else {
        hideError('signup-name-error');
      }
    });

    document.getElementById('signup-email').addEventListener('input', function() {
      const email = this.value;
      if (email.length === 0) {
        hideError('signup-email-error');
      } else if (!validateEmail(email)) {
        showError('signup-email-error', 'Please enter a valid email address with @');
      } else {
        hideError('signup-email-error');
      }
    });

    document.getElementById('signup-password').addEventListener('input', function() {
      const password = this.value;
      const requirements = validatePassword(password);
      updatePasswordStrength(requirements);
      
      const allValid = Object.values(requirements).every(req => req);
      if (password.length === 0) {
        hideError('signup-password-error');
        // Reset strength indicator when password is empty
        document.getElementById('strength-fill').style.width = '0%';
        document.getElementById('strength-text').textContent = 'Password Strength';
        document.getElementById('strength-text').style.color = '#6c757d';
      } else if (!allValid) {
        showError('signup-password-error', 'Password does not meet strength requirements');
      } else {
        hideError('signup-password-error');
      }
    });

    // Real-time validation for signin form
    document.getElementById('signin-email').addEventListener('input', function() {
      const email = this.value;
      if (email.length === 0) {
        hideError('signin-email-error');
      } else if (!validateEmail(email)) {
        showError('signin-email-error', 'Please enter a valid email address with @');
      } else {
        hideError('signin-email-error');
      }
    });

    // Password visibility toggle functionality
    function togglePasswordVisibility(passwordId, toggleId) {
      const passwordInput = document.getElementById(passwordId);
      const toggleButton = document.getElementById(toggleId);
      const eyeIcon = toggleButton.querySelector('.eye-icon');
      const eyeOffIcon = toggleButton.querySelector('.eye-off-icon');
      
      if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        eyeIcon.style.display = 'none';
        eyeOffIcon.style.display = 'block';
      } else {
        passwordInput.type = 'password';
        eyeIcon.style.display = 'block';
        eyeOffIcon.style.display = 'none';
      }
    }

    // Add event listeners for password toggle buttons
    document.getElementById('signin-password-toggle').addEventListener('click', function() {
      togglePasswordVisibility('signin-password', 'signin-password-toggle');
    });

    document.getElementById('signup-password-toggle').addEventListener('click', function() {
      togglePasswordVisibility('signup-password', 'signup-password-toggle');
    });

    // Firebase Configuration - REPLACE WITH YOUR ACTUAL FIREBASE CONFIG
  const firebaseConfig = {
  apiKey: "AIzaSyCveMPPfb0hofCo0bAWnUQhYQlo5aCdANk",
  authDomain: "login-89aa6.firebaseapp.com",
  projectId: "login-89aa6",
  storageBucket: "login-89aa6.firebasestorage.app",
  messagingSenderId: "976356583174",
  appId: "1:976356583174:web:f3e482fed29491f6b56087",
  measurementId: "G-KV5PYS7P6P"
};
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    const db = firebase.firestore();

    async function createUserProfile(user, additionalData = {}) {
      const userRef = db.collection('users').doc(user.uid);
      const snapShot = await userRef.get();

      if (!snapShot.exists) {
        const { displayName, email, uid } = user;
        const createdAt = new Date();

        try {
          await userRef.set({
            uid,
            displayName,
            email,
            createdAt,
            emailVerified: user.emailVerified,
            lastSignIn: createdAt,
            ...additionalData
          });
          console.log('User profile created successfully');
        } catch (error) {
          console.log('Error creating user profile:', error.message);
        }
      }

      return userRef;
    }

    async function updateUserLastSignIn(userId) {
      try {
        const userRef = db.collection('users').doc(userId);
        await userRef.update({
          lastSignIn: new Date(),
          emailVerified: true
        });
      } catch (error) {
        console.log('Error updating user last sign in:', error.message);
      }
    }

    // Form submission handling
    document.getElementById('signin-btn').addEventListener('click', async (e) => {
      e.preventDefault();
      
      const email = document.getElementById('signin-email').value;
      const password = document.getElementById('signin-password').value;
      
      // Validate before submission
      let isValid = true;
      
      if (!email) {
        showError('signin-email-error', 'Email is required');
        isValid = false;
      } else if (!validateEmail(email)) {
        showError('signin-email-error', 'Please enter a valid email address with @');
        isValid = false;
      }
      
      if (!password) {
        showError('signin-password-error', 'Password is required');
        isValid = false;
      }
      
      if (!isValid) return;
      
      try {
        // Firebase authentication
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        const user = userCredential.user;
        
        // Check if email is verified
        if (!user.emailVerified) {
          showAuthMessage('Please verify your email before signing in. Click "Resend Verification Email" if you didn\'t receive it.', 'error');
          document.getElementById('resend-verification-btn').style.display = 'block';
          await auth.signOut();
          return;
        } else {
          document.getElementById('resend-verification-btn').style.display = 'none';
        }
        
        // Update user last sign in and create/update user profile
        await updateUserLastSignIn(user.uid);
        await createUserProfile(user);
        
        showAuthMessage('Logged in successfully!', 'success');
        setTimeout(() => {
          window.location.href = 'home.html';
        }, 1000);
      } catch (error) {
        console.error('Sign in error:', error);
        let errorMessage = 'Sign in failed';
        
        switch (error.code) {
          case 'auth/user-not-found':
            errorMessage = 'No account found with this email address';
            break;
          case 'auth/wrong-password':
            errorMessage = 'Incorrect password';
            break;
          case 'auth/invalid-credential':
            errorMessage = 'Invalid email or password. Please check your credentials and try again.';
            break;
          case 'auth/invalid-email':
            errorMessage = 'Invalid email address format';
            break;
          case 'auth/user-disabled':
            errorMessage = 'This account has been disabled';
            break;
          case 'auth/too-many-requests':
            errorMessage = 'Too many failed attempts. Please try again later';
            break;
          case 'auth/network-request-failed':
            errorMessage = 'Network error. Please check your internet connection';
            break;
          case 'auth/internal-error':
            errorMessage = 'Internal error. Please try again later';
            break;
          default:
            errorMessage = `Sign in failed: ${error.message}`;
        }
        
        showAuthMessage(errorMessage, 'error');
      }
    });

    document.getElementById('signup-btn').addEventListener('click', async (e) => {
      e.preventDefault();
      
      const name = document.getElementById('signup-name').value;
      const email = document.getElementById('signup-email').value;
      const password = document.getElementById('signup-password').value;
      
      // Validate before submission
      let isValid = true;
      
      if (!name) {
        showError('signup-name-error', 'Name is required');
        isValid = false;
      } else if (!validateName(name)) {
        showError('signup-name-error', 'Name must be at least 3 characters long');
        isValid = false;
      }
      
      if (!email) {
        showError('signup-email-error', 'Email is required');
        isValid = false;
      } else if (!validateEmail(email)) {
        showError('signup-email-error', 'Please enter a valid email address with @');
        isValid = false;
      }
      
      if (!password) {
        showError('signup-password-error', 'Password is required');
        isValid = false;
      } else {
        const requirements = validatePassword(password);
        const allValid = Object.values(requirements).every(req => req);
        if (!allValid) {
          showError('signup-password-error', 'Password must meet all requirements below');
          isValid = false;
        }
      }
      
      if (!isValid) return;
      
      try {
        // Create user with Firebase
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        const user = userCredential.user;
        
        // Update user profile with display name
        await user.updateProfile({
          displayName: name
        });
        
        // Create user profile in Firestore
        await createUserProfile(user, { displayName: name });
        
        // Send email verification
        try {
          await user.sendEmailVerification();
          console.log('Email verification sent successfully');
          showAuthMessage('Account created successfully! Please check your email (including spam folder) for verification link.', 'success');
        } catch (verificationError) {
          console.error('Email verification error:', verificationError);
          showAuthMessage('Account created but email verification failed to send. Please try signing in and request verification again.', 'error');
        }
        
        // Sign out the user until they verify their email
        await auth.signOut();
        
      } catch (error) {
        console.error('Sign up error:', error);
        let errorMessage = 'Account creation failed';
        
        switch (error.code) {
          case 'auth/email-already-in-use':
            errorMessage = 'An account with this email already exists';
            break;
          case 'auth/invalid-email':
            errorMessage = 'Invalid email address';
            break;
          case 'auth/operation-not-allowed':
            errorMessage = 'Email/password accounts are not enabled';
            break;
          case 'auth/weak-password':
            errorMessage = 'Password is too weak';
            break;
          default:
            errorMessage = error.message;
        }
        
        showAuthMessage(errorMessage, 'error');
      }
     });

    function showAuthMessage(message, type = 'info') {
      const msg = document.createElement('div');
      msg.className = `auth-message ${type}`;
      msg.textContent = message;
      Object.assign(msg.style, {
        position: 'fixed',
        top: '20px',
        right: '20px',
        backgroundColor: type === 'error' ? '#ff4d4f' : '#4CAF50',
        color: '#fff',
        padding: '12px 18px',
        borderRadius: '6px',
        boxShadow: '0 2px 6px rgba(0,0,0,0.2)',
        zIndex: 1000
      });
      document.body.appendChild(msg);
      setTimeout(() => msg.remove(), 4000);
    }

    // Resend verification email functionality
    document.getElementById('resend-verification-btn').addEventListener('click', async () => {
      const email = document.getElementById('signin-email').value;
      const password = document.getElementById('signin-password').value;
      
      if (!email || !password) {
        showAuthMessage('Please enter your email and password to resend verification.', 'error');
        return;
      }
      
      try {
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        const user = userCredential.user;
        
        if (!user.emailVerified) {
          await user.sendEmailVerification();
          showAuthMessage('Verification email sent successfully! Please check your email (including spam folder).', 'success');
        } else {
          showAuthMessage('Your email is already verified. You can log in now.', 'info');
          document.getElementById('resend-verification-btn').style.display = 'none';
        }
        
        await auth.signOut();
      } catch (error) {
        console.error('Error resending verification email:', error);
        showAuthMessage('Failed to resend verification email. Please check your credentials.', 'error');
      }
    });
  </script>
</body>
</html>
